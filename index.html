<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Virtual Wallet Dashboard</title>
<style>
  body { font-family: Arial, sans-serif; background: #f2f2f2; padding: 20px; }
  h1, h2 { color: #333; }
  form { background: #fff; padding: 15px; margin-bottom: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
  input, select { padding: 8px; margin: 5px 0; width: 100%; box-sizing: border-box; }
  button { padding: 10px 15px; margin-top: 10px; cursor: pointer; background: #4CAF50; color: #fff; border: none; border-radius: 5px; }
  button:hover { background: #45a049; }
  .output { background: #fff; padding: 10px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 20px; white-space: pre-wrap; }
</style>
</head>
<body>

<h1>Virtual Wallet Dashboard</h1>

<!-- Create Wallet -->
<h2>Create Wallet</h2>
<form id="createWalletForm">
  <input type="text" id="tenantId" placeholder="Tenant ID (optional)">
  <input type="text" id="tokens" placeholder="Tokens (comma separated, optional)">
  <button type="submit">Create Wallet</button>
</form>
<div id="createWalletOutput" class="output"></div>

<!-- Single Balance -->
<h2>Check Balance</h2>
<form id="balanceForm">
  <input type="text" id="balanceWalletId" placeholder="Wallet ID">
  <input type="text" id="balanceToken" placeholder="Token Symbol">
  <button type="submit">Get Balance</button>
</form>
<div id="balanceOutput" class="output"></div>

<!-- All Balances -->
<h2>All Balances</h2>
<form id="allBalancesForm">
  <input type="text" id="allBalancesWalletId" placeholder="Wallet ID">
  <button type="submit">Get All Balances</button>
</form>
<div id="allBalancesOutput" class="output"></div>

<!-- Credit Wallet -->
<h2>Credit Wallet</h2>
<form id="creditForm">
  <input type="text" id="creditWalletId" placeholder="Wallet ID">
  <input type="text" id="creditToken" placeholder="Token Symbol">
  <input type="number" id="creditAmount" placeholder="Amount">
  <input type="text" id="creditMeta" placeholder='Meta JSON (optional, e.g. {"note":"test"})'>
  <button type="submit">Credit</button>
</form>
<div id="creditOutput" class="output"></div>

<!-- Debit Wallet -->
<h2>Debit Wallet</h2>
<form id="debitForm">
  <input type="text" id="debitWalletId" placeholder="Wallet ID">
  <input type="text" id="debitToken" placeholder="Token Symbol">
  <input type="number" id="debitAmount" placeholder="Amount">
  <input type="text" id="debitMeta" placeholder='Meta JSON (optional, e.g. {"note":"test"})'>
  <button type="submit">Debit</button>
</form>
<div id="debitOutput" class="output"></div>

<!-- Transaction History -->
<h2>Transaction History</h2>
<form id="transactionsForm">
  <input type="text" id="transactionsWalletId" placeholder="Wallet ID">
  <input type="text" id="transactionsToken" placeholder="Token (optional)">
  <button type="submit">Get Transactions</button>
</form>
<div id="transactionsOutput" class="output"></div>

<script>
const API_BASE = "https://escrow-blackp2p-com.onrender.com/api"; // âœ… valid HTTPS domain
const API_KEY = "97f8-832d-85b5-a40758b5820"; // Testing only

function displayOutput(elementId, data) {
  document.getElementById(elementId).textContent = JSON.stringify(data, null, 2);
}

function authHeaders() {
  return { "Content-Type": "application/json", "x-api-key": API_KEY };
}

// ---------------- Create Wallet ----------------
document.getElementById("createWalletForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  const tenantId = document.getElementById("tenantId").value.trim() || undefined;
  const tokensInput = document.getElementById("tokens").value.trim();
  const tokens = tokensInput ? tokensInput.split(",").map(t => t.trim()) : undefined;
  try {
    const res = await fetch(`${API_BASE}/create`, {
      method: "POST",
      headers: authHeaders(),
      body: JSON.stringify({ tenantId, tokens })
    });
    const data = await res.json();
    displayOutput("createWalletOutput", data);
  } catch (err) { displayOutput("createWalletOutput", { error: err.message }); }
});

// ---------------- Single Balance ----------------
document.getElementById("balanceForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  const walletId = document.getElementById("balanceWalletId").value.trim();
  const token = document.getElementById("balanceToken").value.trim();
  try {
    const res = await fetch(`${API_BASE}/balance?walletId=${walletId}&token=${token}`, { headers: authHeaders() });
    const data = await res.json();
    displayOutput("balanceOutput", data);
  } catch (err) { displayOutput("balanceOutput", { error: err.message }); }
});

// ---------------- All Balances ----------------
document.getElementById("allBalancesForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  const walletId = document.getElementById("allBalancesWalletId").value.trim();
  try {
    const res = await fetch(`${API_BASE}/balances?walletId=${walletId}`, { headers: authHeaders() });
    const data = await res.json();
    displayOutput("allBalancesOutput", data);
  } catch (err) { displayOutput("allBalancesOutput", { error: err.message }); }
});

// ---------------- Credit Wallet ----------------
document.getElementById("creditForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  const walletId = document.getElementById("creditWalletId").value.trim();
  const token = document.getElementById("creditToken").value.trim();
  const amount = parseFloat(document.getElementById("creditAmount").value.trim());
  let meta;
  try { meta = document.getElementById("creditMeta").value ? JSON.parse(document.getElementById("creditMeta").value) : undefined; } 
  catch { alert("Meta must be valid JSON"); return; }
  try {
    const res = await fetch(`${API_BASE}/credit`, { method: "POST", headers: authHeaders(), body: JSON.stringify({ walletId, token, amount, meta }) });
    const data = await res.json();
    displayOutput("creditOutput", data);
  } catch (err) { displayOutput("creditOutput", { error: err.message }); }
});

// ---------------- Debit Wallet ----------------
document.getElementById("debitForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  const walletId = document.getElementById("debitWalletId").value.trim();
  const token = document.getElementById("debitToken").value.trim();
  const amount = parseFloat(document.getElementById("debitAmount").value.trim());
  let meta;
  try { meta = document.getElementById("debitMeta").value ? JSON.parse(document.getElementById("debitMeta").value) : undefined; } 
  catch { alert("Meta must be valid JSON"); return; }
  try {
    const res = await fetch(`${API_BASE}/debit`, { method: "POST", headers: authHeaders(), body: JSON.stringify({ walletId, token, amount, meta }) });
    const data = await res.json();
    displayOutput("debitOutput", data);
  } catch (err) { displayOutput("debitOutput", { error: err.message }); }
});

// ---------------- Transaction History ----------------
document.getElementById("transactionsForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  const walletId = document.getElementById("transactionsWalletId").value.trim();
  const token = document.getElementById("transactionsToken").value.trim();
  const url = token ? `${API_BASE}/transactions?walletId=${walletId}&token=${token}` : `${API_BASE}/transactions?walletId=${walletId}`;
  try {
    const res = await fetch(url, { headers: authHeaders() });
    const data = await res.json();
    displayOutput("transactionsOutput", data);
  } catch (err) { displayOutput("transactionsOutput", { error: err.message }); }
});
</script>

</body>
</html>